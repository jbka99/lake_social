{#
  Right sidebar (v1): user panel.
  Keep logic minimal: just links.
#}

<div class="card border shadow-sm sidebar-card">
  <div class="card-body">
    {% if current_user.is_authenticated %}
      <div class="d-flex align-items-center gap-3 mb-3">
        <img
          src="{{ current_user.avatar_url if current_user.avatar_url else 'https://api.dicebear.com/7.x/identicon/svg?seed=' + current_user.username }}"
          alt="AV"
          class="rounded-circle border"
          style="width: 44px; height: 44px; object-fit: cover;"
          referrerpolicy="no-referrer"
        >

        <div class="lh-sm">
          <div class="fw-semibold">{{ current_user.display_name or current_user.username }}</div>
          <div class="text-secondary small">@{{ current_user.username }}</div>
        </div>
      </div>

      <div class="list-group list-group-flush">
        <a class="list-group-item list-group-item-action px-0" href="{{ url_for('routes.index') }}">
          Профиль
        </a>
        <a class="list-group-item list-group-item-action px-0" href="{{ url_for('routes.settings') }}">
          Редактировать профиль
        </a>
        <a class="list-group-item list-group-item-action px-0" href="#" aria-disabled="true">
          Личные сообщения <span class="badge text-bg-light border ms-2">скоро</span>
        </a>

        {# Админка: показываем только если пользователь админ И маршрут существует #}
        {% if current_user.is_authenticated and current_user.is_admin %}
        {% set admin_endpoint = (
        'routes.admin_users'
        if 'routes.admin_users' in current_app.view_functions
        else (
          'routes.admin'
          if 'routes.admin' in current_app.view_functions
          else (
            'routes.admin_index'
            if 'routes.admin_index' in current_app.view_functions
            else None
          )
        )
      )
    %}

    {% if admin_endpoint %}
      <a class="list-group-item list-group-item-action" href="{{ url_for(admin_endpoint) }}">
        Админка
      </a>
    {% endif %}
  {% endif %}

        <a class="list-group-item list-group-item-action px-0 text-danger" href="{{ url_for('routes.logout') }}">
          Выход
        </a>
      </div>
    {% else %}
      <div class="fw-semibold mb-2">Аккаунт</div>
      <div class="list-group list-group-flush">
        <a class="list-group-item list-group-item-action px-0" href="{{ url_for('routes.login') }}">Вход</a>
        <a class="list-group-item list-group-item-action px-0" href="{{ url_for('routes.register') }}">Регистрация</a>
      </div>
    {% endif %}
  </div>
</div>
